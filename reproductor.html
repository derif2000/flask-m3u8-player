<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Mi reproductor HLS</title>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
</head>
<body>
<h1>Mi reproductor HLS</h1>

<input type="text" id="videoUrl" placeholder="URL del video" style="width: 80%;">
<button id="playBtn">Reproducir</button>

<video id="video" controls width="640" height="360"></video>

<script>
window.addEventListener("DOMContentLoaded", () => {
    const playBtn = document.getElementById("playBtn");
    const videoInput = document.getElementById("videoUrl");
    const video = document.getElementById("video");
    const apiUrl = "http://[2a00:1838:37:4db:ab74]:8000/get_m3u8"; // tu IP y puerto

    playBtn.addEventListener("click", async () => {
        const url = videoInput.value.trim();

        if (!url) {
            alert("Por favor ingresa una URL");
            return;
        }

        video.src = "";
        video.load();

        try {
            const resp = await fetch(apiUrl, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ url })
            });

            const data = await resp.json();

            if (data.m3u8) {
                if (Hls.isSupported()) {
                    const hls = new Hls();
                    hls.loadSource(data.m3u8);
                    hls.attachMedia(video);
                    hls.on(Hls.Events.MANIFEST_PARSED, () => {
                        video.play();
                    });
                } else if (video.canPlayType("application/vnd.apple.mpegurl")) {
                    video.src = data.m3u8;
                    video.addEventListener("loadedmetadata", () => {
                        video.play();
                    });
                } else {
                    alert("Tu navegador no soporta HLS");
                }
            } else {
                alert("No se encontr√≥ un enlace .m3u8");
            }

        } catch (err) {
            console.error(err);
            alert("Error al llamar la API o al procesar la respuesta");
        }
    });
});
</script>
</body>
</html>
